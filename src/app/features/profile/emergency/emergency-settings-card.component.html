<div class="emergency-settings-wrapper-card">
  <div class="emergency-settings-header-bar">
    <ion-icon name="settings-outline"></ion-icon>
    <span>Emergency Settings</span>
  </div>
  <div class="settings-group">
    <div class="emergency-setting-card compact">
      <div class="emergency-setting-info">
        <div class="emergency-setting-title">Shake to Alert</div>
        <div class="emergency-setting-desc">Shake phone to trigger emergency</div>
      </div>
      <ion-toggle [(ngModel)]="emergencySettings.shakeToAlert" (ionChange)="saveEmergencySettings()"></ion-toggle>
    </div>

    <div class="emergency-setting-card compact">
      <div class="emergency-setting-info">
        <div class="emergency-setting-title">Power Button Alert</div>
        <div class="emergency-setting-desc">Press power button 3 times</div>
      </div>
      <ion-toggle [(ngModel)]="emergencySettings.powerButtonAlert" (ionChange)="saveEmergencySettings()"></ion-toggle>
    </div>

    <div class="emergency-setting-card compact">
      <div class="emergency-setting-info">
        <div class="emergency-setting-title">Audio Instructions</div>
        <div class="emergency-setting-desc">Play emergency message aloud</div>
        <div class="emergency-setting-status" *ngIf="emergencySettings.audioInstructions">
          <span [class]="getAudioSourceClass()">{{ getAudioSourceText() }}</span>
        </div>
      </div>
      <div class="emergency-setting-actions">
        <ion-button *ngIf="emergencySettings.audioInstructions" 
                    (click)="openVoiceRecordingModal()" 
                    fill="clear" 
                    size="small"
                    [color]="showVoiceSettings ? 'primary' : 'medium'">
          <ion-icon name="mic-outline" slot="icon-only"></ion-icon>
        </ion-button>
        <ion-toggle [(ngModel)]="emergencySettings.audioInstructions" (ionChange)="saveEmergencySettings()"></ion-toggle>
      </div>
      <div class="inline-add-instructions" *ngIf="isEmergencyInstructionsEmpty()">
        <ion-button size="small" fill="outline" color="primary" (click)="openEditEmergencyMessageModal()">
          <ion-icon name="add-outline" slot="start"></ion-icon>
          Add Instructions
        </ion-button>
      </div>
    </div>
  </div>

  <div class="emergency-testing-subheader">Quick Tests</div>
  <div class="emergency-test-grid">
    <ion-button fill="outline" size="small" (click)="testEmergencyAlert()">
      <ion-icon name="warning-outline" slot="start"></ion-icon>
      Alert
    </ion-button>
    <ion-button fill="outline" size="small" (click)="testShakeDetection()">
      <ion-icon name="phone-portrait-outline" slot="start"></ion-icon>
      Shake
    </ion-button>
    <ion-button fill="outline" size="small" (click)="testPowerButtonDetection()">
      <ion-icon name="power-outline" slot="start"></ion-icon>
      Power Btn
    </ion-button>
    <ion-button fill="outline" size="small" (click)="testAudioInstructions()">
      <ion-icon name="volume-high-outline" slot="start"></ion-icon>
      Audio
    </ion-button>
    <ion-button fill="outline" size="small" (click)="requestMotionPermissions()">
      <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
      Motion Perms
    </ion-button>
    <ion-button fill="outline" size="small" (click)="showEmergencyExamples()">
      <ion-icon name="book-outline" slot="start"></ion-icon>
      Examples
    </ion-button>
  </div>
</div>

<ng-content select=".emergency-instructions-display"></ng-content>

